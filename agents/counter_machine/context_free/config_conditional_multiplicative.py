from agents.counter_machine.machine import CounterMachine


class ContextFreeCounterMachine_Conditional_Multiplicative(CounterMachine):
    def __init__(self):
        super().__init__()
        self.U = [0, 1, 2]
        self.F = [3]
        self.u_0 = 0

        self.delta_u = {
            # State 0: Collect A N times
            (("A",), 0, ("Z","-","-","-")): 0,
            (("A",), 0, ("NZ","Z","-","-")): 0,
            (("A",), 0, ("NZ","NZ","-","-")): 0,
            (("B",), 0, ("-","-","-","-")): 1,
            (("C",), 0, ("-","-","-","-")): 3,
            (("D",), 0, ("-","-","-","-")): 3,
            (("E",), 0, ("-","-","-","-")): 3,
            ((), 0, ("-","-","-","-")): 0,

            # State 1: Collect C M times
            (("A",), 1, ("-","-","-","-")): 3,
            (("B",), 1, ("-","-","-","-")): 3,
            (("C",), 1, ("-","-","Z","-")): 1,
            (("C",), 1, ("-","-","NZ","Z")): 1,
            (("C",), 1, ("-","-","NZ","NZ")): 1,
            (("D",), 1, ("-","-","-","-")): 2,
            (("E",), 1, ("-","-","-","-")): 3,
            ((), 1, ("-","-","-","-")): 1,


            # State 2: Choose E if n*m > 3 else Choose B
            (("A",), 2, ("-","-","-","-")): 3,
            (("B",), 2, ("NZ","Z","NZ","Z")): 3,
            (("B",), 2, ("NZ","NZ","NZ","Z")): 3,
            (("B",), 2, ("NZ","Z","NZ","NZ")): 3,
            (("B",), 2, ("NZ","NZ","NZ","NZ")): 3,
            (("C",), 2, ("-","-","-","-")): 3,
            (("D",), 2, ("-","-","-","-")): 3,
            (("E",), 2, ("NZ","Z","NZ","Z")): 3,
            (("E",), 2, ("NZ","NZ","NZ","Z")): 3,
            (("E",), 2, ("NZ","Z","NZ","NZ")): 3,
            (("E",), 2, ("NZ","NZ","NZ","NZ")): 3,
            ((), 2, ("-","-","-","-")): 2,
        }

        self.delta_c = {
            (("A",), 0, ("Z","-","-","-")): (1,0,0,0),
            (("A",), 0, ("NZ","Z","-","-")): (0,1,0,0),
            (("A",), 0, ("NZ","NZ","-","-")): (0,1,0,0),
            (("B",), 0, ("-","-","-","-")): (0,0,0,0),
            (("C",), 0, ("-","-","-","-")): (0,0,0,0),
            (("D",), 0, ("-","-","-","-")): (0,0,0,0),
            (("E",), 0, ("-","-","-","-")): (0,0,0,0),
            ((), 0, ("-","-","-","-")): (0,0,0,0),

            (("A",), 1, ("-","-","-","-")): (0,0,0,0),
            (("B",), 1, ("-","-","-","-")): (0,0,0,0),
            (("C",), 1, ("-","-","Z","-")): (0,0,1,0),
            (("C",), 1, ("-","-","NZ","Z")): (0,0,0,1),
            (("C",), 1, ("-","-","NZ","NZ")): (0,0,0,1),
            (("D",), 1, ("-","-","-","-")): (0,0,0,0),
            (("E",), 1, ("-","-","-","-")): (0,0,0,0),
            ((), 1, ("-","-","-","-")): (0,0,0,0),

            (("A",), 2, ("-","-","-","-")): (0,0,0,0),
            (("B",), 2, ("NZ","Z","NZ","Z")): (0,0,0,0),
            (("B",), 2, ("NZ","NZ","NZ","Z")): (0,0,0,0),
            (("B",), 2, ("NZ","Z","NZ","NZ")): (0,0,0,0),
            (("B",), 2, ("NZ","NZ","NZ","NZ")): (0,0,0,0),
            (("C",), 2, ("-","-","-","-")): (0,0,0,0),
            (("D",), 2, ("-","-","-","-")): (0,0,0,0),
            (("E",), 2, ("NZ","Z","NZ","Z")): (0,0,0,0),
            (("E",), 2, ("NZ","NZ","NZ","Z")): (0,0,0,0),
            (("E",), 2, ("NZ","Z","NZ","NZ")): (0,0,0,0),
            (("E",), 2, ("NZ","NZ","NZ","NZ")): (0,0,0,0),
            ((), 2, ("-","-","-","-")): (0,0,0,0),
        }
        self.delta_r = {
            (("A",), 0, ("Z","-","-","-")): 1,
            (("A",), 0, ("NZ","Z","-","-")): 1,
            (("A",), 0, ("NZ","NZ","-","-")): 1,
            (("B",), 0, ("-","-","-","-")): 1,
            (("C",), 0, ("-","-","-","-")): -1,
            (("D",), 0, ("-","-","-","-")): -1,
            (("E",), 0, ("-","-","-","-")): -1,
            ((), 0, ("-","-","-","-")): 0,

            (("A",), 1, ("-","-","-","-")): -1,
            (("B",), 1, ("-","-","-","-")): -1,
            (("C",), 1, ("-","-","Z","-")): 1,
            (("C",), 1, ("-","-","NZ","Z")): 1,
            (("C",), 1, ("-","-","NZ","NZ")): 1,
            (("D",), 1, ("-","-","-","-")): 1,
            (("E",), 1, ("-","-","-","-")): -1,
            ((), 1, ("-","-","-","-")): 0,

            (("A",), 2, ("-","-","-","-")): -1,
            (("B",), 2, ("NZ","Z","NZ","Z")): 1,
            (("B",), 2, ("NZ","NZ","NZ","Z")): 1,
            (("B",), 2, ("NZ","Z","NZ","NZ")): 1,
            (("B",), 2, ("NZ","NZ","NZ","NZ")): -1,
            (("C",), 2, ("-","-","-","-")): -1,
            (("D",), 2, ("-","-","-","-")): -1,
            (("E",), 2, ("NZ","Z","NZ","Z")): -1,
            (("E",), 2, ("NZ","NZ","NZ","Z")): -1,
            (("E",), 2, ("NZ","Z","NZ","NZ")): -1,
            (("E",), 2, ("NZ","NZ","NZ","NZ")): 1,
            ((), 2, ("-","-","-","-")): 0,
        }
        self._init_transitions()
